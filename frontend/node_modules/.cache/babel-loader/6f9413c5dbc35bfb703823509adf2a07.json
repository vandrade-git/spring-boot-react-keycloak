{"ast":null,"code":"import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport { createContext, createElement, PureComponent } from 'react';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inheritsLoose from '@babel/runtime/helpers/inheritsLoose';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport PropTypes from 'prop-types';\nimport isEqual from 'react-fast-compare';\n\nfunction createReactKeycloakContext(initialContext) {\n  return createContext(_objectSpread({\n    initialized: false\n  }, initialContext));\n}\n\nvar initialState = {\n  initialized: false,\n  isLoading: true,\n  token: undefined\n};\n\nfunction createReactKeycloakProvider(ReactKeycloakContext) {\n  var KeycloakProvider = /*#__PURE__*/function (_React$PureComponent) {\n    _inheritsLoose(KeycloakProvider, _React$PureComponent);\n\n    function KeycloakProvider() {\n      var _this;\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n\n      _defineProperty(_assertThisInitialized(_this), \"defaultInitConfig\", {\n        onLoad: 'check-sso',\n        promiseType: 'native'\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"state\", _objectSpread({}, initialState));\n\n      _defineProperty(_assertThisInitialized(_this), \"onKeycloakError\", function (event) {\n        return function (error) {\n          var onEvent = _this.props.onEvent; // Notify Events listener\n\n          onEvent && onEvent(event, error);\n        };\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"updateState\", function (event) {\n        return function () {\n          var _this$props = _this.props,\n              keycloak = _this$props.keycloak,\n              onEvent = _this$props.onEvent,\n              onTokens = _this$props.onTokens,\n              isLoadingCheck = _this$props.isLoadingCheck;\n          var _this$state = _this.state,\n              prevInitialized = _this$state.initialized,\n              prevLoading = _this$state.isLoading,\n              prevToken = _this$state.token;\n          var idToken = keycloak.idToken,\n              refreshToken = keycloak.refreshToken,\n              newToken = keycloak.token; // Notify Events listener\n\n          onEvent && onEvent(event); // Check Loading state\n\n          var isLoading = isLoadingCheck ? isLoadingCheck(keycloak) : false; // Avoid double-refresh if state hasn't changed\n\n          if (!prevInitialized || isLoading !== prevLoading || newToken !== prevToken) {\n            _this.setState({\n              initialized: true,\n              isLoading: isLoading,\n              token: newToken\n            });\n          } // Notify token listener, if any\n\n\n          if (newToken !== prevToken) {\n            onTokens && onTokens({\n              idToken: idToken,\n              refreshToken: refreshToken,\n              token: newToken\n            });\n          }\n        };\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"refreshKeycloakToken\", function (event) {\n        return function () {\n          var _this$props2 = _this.props,\n              autoRefreshToken = _this$props2.autoRefreshToken,\n              keycloak = _this$props2.keycloak,\n              onEvent = _this$props2.onEvent; // Notify Events listener\n\n          onEvent && onEvent(event);\n\n          if (autoRefreshToken) {\n            // Refresh Keycloak token\n            keycloak.updateToken(5);\n          }\n        };\n      });\n\n      return _this;\n    }\n\n    var _proto = KeycloakProvider.prototype;\n\n    _proto.componentDidMount = function componentDidMount() {\n      this.init();\n    };\n\n    _proto.componentDidUpdate = function componentDidUpdate(_ref) {\n      var prevKeycloak = _ref.keycloak,\n          prevInitConfig = _ref.initConfig;\n\n      if (this.props.keycloak !== prevKeycloak || !isEqual(this.props.initConfig, prevInitConfig)) {\n        // De-init previous Keycloak instance\n        prevKeycloak.onReady = undefined;\n        prevKeycloak.onAuthSuccess = undefined;\n        prevKeycloak.onAuthError = undefined;\n        prevKeycloak.onAuthRefreshSuccess = undefined;\n        prevKeycloak.onAuthRefreshError = undefined;\n        prevKeycloak.onAuthLogout = undefined;\n        prevKeycloak.onTokenExpired = undefined; // Reset state\n\n        this.setState(_objectSpread({}, initialState)); // Init new Keycloak instance\n\n        this.init();\n      }\n    };\n\n    _proto.init = function init() {\n      var _this$props3 = this.props,\n          initConfig = _this$props3.initConfig,\n          keycloak = _this$props3.keycloak; // Attach Keycloak listeners\n\n      keycloak.onReady = this.updateState('onReady');\n      keycloak.onAuthSuccess = this.updateState('onAuthSuccess');\n      keycloak.onAuthError = this.onKeycloakError('onAuthError');\n      keycloak.onAuthRefreshSuccess = this.updateState('onAuthRefreshSuccess');\n      keycloak.onAuthRefreshError = this.onKeycloakError('onAuthRefreshError');\n      keycloak.onAuthLogout = this.updateState('onAuthLogout');\n      keycloak.onTokenExpired = this.refreshKeycloakToken('onTokenExpired');\n      keycloak.init(_objectSpread(_objectSpread({}, this.defaultInitConfig), initConfig)).catch(this.onKeycloakError('onInitError'));\n    };\n\n    _proto.render = function render() {\n      var _this$props4 = this.props,\n          children = _this$props4.children,\n          keycloak = _this$props4.keycloak,\n          LoadingComponent = _this$props4.LoadingComponent;\n      var _this$state2 = this.state,\n          initialized = _this$state2.initialized,\n          isLoading = _this$state2.isLoading;\n\n      if (!!LoadingComponent && (!initialized || isLoading)) {\n        return LoadingComponent;\n      }\n\n      return /*#__PURE__*/createElement(ReactKeycloakContext.Provider, {\n        value: {\n          initialized: initialized,\n          keycloak: keycloak\n        }\n      }, children);\n    };\n\n    return KeycloakProvider;\n  }(PureComponent);\n\n  process.env.NODE_ENV !== \"production\" ? KeycloakProvider.propTypes = {\n    children: PropTypes.element.isRequired,\n    keycloak: PropTypes.shape({\n      init: PropTypes.func.isRequired,\n      updateToken: PropTypes.func.isRequired,\n      idToken: PropTypes.string,\n      refreshToken: PropTypes.string,\n      token: PropTypes.string,\n      onReady: PropTypes.func,\n      onAuthSuccess: PropTypes.func,\n      onAuthError: PropTypes.func,\n      onAuthRefreshSuccess: PropTypes.func,\n      onAuthRefreshError: PropTypes.func,\n      onAuthLogout: PropTypes.func,\n      onTokenExpired: PropTypes.func\n    }).isRequired,\n    autoRefreshToken: PropTypes.bool,\n    initConfig: PropTypes.shape({}),\n    isLoadingCheck: PropTypes.func,\n    LoadingComponent: PropTypes.element,\n    onError: PropTypes.func,\n    onEvent: PropTypes.func,\n    onTokens: PropTypes.func\n  } : void 0;\n  KeycloakProvider.defaultProps = {\n    autoRefreshToken: true,\n    initConfig: {\n      onLoad: 'check-sso',\n      promiseType: 'native'\n    },\n    isLoadingCheck: null,\n    LoadingComponent: null,\n    onError: null,\n    onEvent: null,\n    onTokens: null\n  };\n  return KeycloakProvider;\n}\n\nexport { createReactKeycloakContext, createReactKeycloakProvider };","map":{"version":3,"sources":["/home/vandrade/Documents/Projects/Personal/keycloak-experiment/frontend/node_modules/@react-keycloak/core/dist/es/react-keycloak-core.js"],"names":["_objectSpread","createContext","createElement","PureComponent","_assertThisInitialized","_inheritsLoose","_defineProperty","PropTypes","isEqual","createReactKeycloakContext","initialContext","initialized","initialState","isLoading","token","undefined","createReactKeycloakProvider","ReactKeycloakContext","KeycloakProvider","_React$PureComponent","_this","_len","arguments","length","args","Array","_key","call","apply","concat","onLoad","promiseType","event","error","onEvent","props","_this$props","keycloak","onTokens","isLoadingCheck","_this$state","state","prevInitialized","prevLoading","prevToken","idToken","refreshToken","newToken","setState","_this$props2","autoRefreshToken","updateToken","_proto","prototype","componentDidMount","init","componentDidUpdate","_ref","prevKeycloak","prevInitConfig","initConfig","onReady","onAuthSuccess","onAuthError","onAuthRefreshSuccess","onAuthRefreshError","onAuthLogout","onTokenExpired","_this$props3","updateState","onKeycloakError","refreshKeycloakToken","defaultInitConfig","catch","render","_this$props4","children","LoadingComponent","_this$state2","Provider","value","process","env","NODE_ENV","propTypes","element","isRequired","shape","func","string","bool","onError","defaultProps"],"mappings":"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","sourcesContent":["import _objectSpread from '@babel/runtime/helpers/objectSpread2';\nimport { createContext, createElement, PureComponent } from 'react';\nimport _assertThisInitialized from '@babel/runtime/helpers/assertThisInitialized';\nimport _inheritsLoose from '@babel/runtime/helpers/inheritsLoose';\nimport _defineProperty from '@babel/runtime/helpers/defineProperty';\nimport PropTypes from 'prop-types';\nimport isEqual from 'react-fast-compare';\n\nfunction createReactKeycloakContext(initialContext) {\n  return createContext(_objectSpread({\n    initialized: false\n  }, initialContext));\n}\n\nvar initialState = {\n  initialized: false,\n  isLoading: true,\n  token: undefined\n};\nfunction createReactKeycloakProvider(ReactKeycloakContext) {\n  var KeycloakProvider = /*#__PURE__*/function (_React$PureComponent) {\n    _inheritsLoose(KeycloakProvider, _React$PureComponent);\n\n    function KeycloakProvider() {\n      var _this;\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      _this = _React$PureComponent.call.apply(_React$PureComponent, [this].concat(args)) || this;\n\n      _defineProperty(_assertThisInitialized(_this), \"defaultInitConfig\", {\n        onLoad: 'check-sso',\n        promiseType: 'native'\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"state\", _objectSpread({}, initialState));\n\n      _defineProperty(_assertThisInitialized(_this), \"onKeycloakError\", function (event) {\n        return function (error) {\n          var onEvent = _this.props.onEvent; // Notify Events listener\n\n          onEvent && onEvent(event, error);\n        };\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"updateState\", function (event) {\n        return function () {\n          var _this$props = _this.props,\n              keycloak = _this$props.keycloak,\n              onEvent = _this$props.onEvent,\n              onTokens = _this$props.onTokens,\n              isLoadingCheck = _this$props.isLoadingCheck;\n          var _this$state = _this.state,\n              prevInitialized = _this$state.initialized,\n              prevLoading = _this$state.isLoading,\n              prevToken = _this$state.token;\n          var idToken = keycloak.idToken,\n              refreshToken = keycloak.refreshToken,\n              newToken = keycloak.token; // Notify Events listener\n\n          onEvent && onEvent(event); // Check Loading state\n\n          var isLoading = isLoadingCheck ? isLoadingCheck(keycloak) : false; // Avoid double-refresh if state hasn't changed\n\n          if (!prevInitialized || isLoading !== prevLoading || newToken !== prevToken) {\n            _this.setState({\n              initialized: true,\n              isLoading: isLoading,\n              token: newToken\n            });\n          } // Notify token listener, if any\n\n\n          if (newToken !== prevToken) {\n            onTokens && onTokens({\n              idToken: idToken,\n              refreshToken: refreshToken,\n              token: newToken\n            });\n          }\n        };\n      });\n\n      _defineProperty(_assertThisInitialized(_this), \"refreshKeycloakToken\", function (event) {\n        return function () {\n          var _this$props2 = _this.props,\n              autoRefreshToken = _this$props2.autoRefreshToken,\n              keycloak = _this$props2.keycloak,\n              onEvent = _this$props2.onEvent; // Notify Events listener\n\n          onEvent && onEvent(event);\n\n          if (autoRefreshToken) {\n            // Refresh Keycloak token\n            keycloak.updateToken(5);\n          }\n        };\n      });\n\n      return _this;\n    }\n\n    var _proto = KeycloakProvider.prototype;\n\n    _proto.componentDidMount = function componentDidMount() {\n      this.init();\n    };\n\n    _proto.componentDidUpdate = function componentDidUpdate(_ref) {\n      var prevKeycloak = _ref.keycloak,\n          prevInitConfig = _ref.initConfig;\n\n      if (this.props.keycloak !== prevKeycloak || !isEqual(this.props.initConfig, prevInitConfig)) {\n        // De-init previous Keycloak instance\n        prevKeycloak.onReady = undefined;\n        prevKeycloak.onAuthSuccess = undefined;\n        prevKeycloak.onAuthError = undefined;\n        prevKeycloak.onAuthRefreshSuccess = undefined;\n        prevKeycloak.onAuthRefreshError = undefined;\n        prevKeycloak.onAuthLogout = undefined;\n        prevKeycloak.onTokenExpired = undefined; // Reset state\n\n        this.setState(_objectSpread({}, initialState)); // Init new Keycloak instance\n\n        this.init();\n      }\n    };\n\n    _proto.init = function init() {\n      var _this$props3 = this.props,\n          initConfig = _this$props3.initConfig,\n          keycloak = _this$props3.keycloak; // Attach Keycloak listeners\n\n      keycloak.onReady = this.updateState('onReady');\n      keycloak.onAuthSuccess = this.updateState('onAuthSuccess');\n      keycloak.onAuthError = this.onKeycloakError('onAuthError');\n      keycloak.onAuthRefreshSuccess = this.updateState('onAuthRefreshSuccess');\n      keycloak.onAuthRefreshError = this.onKeycloakError('onAuthRefreshError');\n      keycloak.onAuthLogout = this.updateState('onAuthLogout');\n      keycloak.onTokenExpired = this.refreshKeycloakToken('onTokenExpired');\n      keycloak.init(_objectSpread(_objectSpread({}, this.defaultInitConfig), initConfig)).catch(this.onKeycloakError('onInitError'));\n    };\n\n    _proto.render = function render() {\n      var _this$props4 = this.props,\n          children = _this$props4.children,\n          keycloak = _this$props4.keycloak,\n          LoadingComponent = _this$props4.LoadingComponent;\n      var _this$state2 = this.state,\n          initialized = _this$state2.initialized,\n          isLoading = _this$state2.isLoading;\n\n      if (!!LoadingComponent && (!initialized || isLoading)) {\n        return LoadingComponent;\n      }\n\n      return /*#__PURE__*/createElement(ReactKeycloakContext.Provider, {\n        value: {\n          initialized: initialized,\n          keycloak: keycloak\n        }\n      }, children);\n    };\n\n    return KeycloakProvider;\n  }(PureComponent);\n\n  process.env.NODE_ENV !== \"production\" ? KeycloakProvider.propTypes = {\n    children: PropTypes.element.isRequired,\n    keycloak: PropTypes.shape({\n      init: PropTypes.func.isRequired,\n      updateToken: PropTypes.func.isRequired,\n      idToken: PropTypes.string,\n      refreshToken: PropTypes.string,\n      token: PropTypes.string,\n      onReady: PropTypes.func,\n      onAuthSuccess: PropTypes.func,\n      onAuthError: PropTypes.func,\n      onAuthRefreshSuccess: PropTypes.func,\n      onAuthRefreshError: PropTypes.func,\n      onAuthLogout: PropTypes.func,\n      onTokenExpired: PropTypes.func\n    }).isRequired,\n    autoRefreshToken: PropTypes.bool,\n    initConfig: PropTypes.shape({}),\n    isLoadingCheck: PropTypes.func,\n    LoadingComponent: PropTypes.element,\n    onError: PropTypes.func,\n    onEvent: PropTypes.func,\n    onTokens: PropTypes.func\n  } : void 0;\n  KeycloakProvider.defaultProps = {\n    autoRefreshToken: true,\n    initConfig: {\n      onLoad: 'check-sso',\n      promiseType: 'native'\n    },\n    isLoadingCheck: null,\n    LoadingComponent: null,\n    onError: null,\n    onEvent: null,\n    onTokens: null\n  };\n  return KeycloakProvider;\n}\n\nexport { createReactKeycloakContext, createReactKeycloakProvider };\n"]},"metadata":{},"sourceType":"module"}